<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pasta League 2025 âš½</title>
<style>
body {
  font-family: 'Arial', sans-serif;
  background-color: #000;
  color: #fff;
  text-align: center;
  margin: 0;
  padding: 0;
}
h1 {
  font-size: 2.5em;
  color: gold;
  text-shadow: 0 0 20px yellow;
  margin-top: 20px;
}
table {
  width: 90%;
  margin: 20px auto;
  border-collapse: collapse;
  color: white;
  box-shadow: 0 0 20px yellow;
}
th, td {
  padding: 10px;
  border: 1px solid yellow;
}
th {
  background-color: #111;
  color: gold;
}
tr:nth-child(odd) { background-color: #222; }
tr:nth-child(even) { background-color: #111; }

.gold { background-color: rgba(255,215,0,0.2); border: 2px solid gold; }
.playoff { background-color: rgba(0,191,255,0.2); border: 2px solid #00bfff; }

.player-card {
  display: inline-block;
  width: 180px;
  margin: 15px;
  background: #111;
  border: 2px solid yellow;
  border-radius: 10px;
  box-shadow: 0 0 10px yellow;
  padding: 10px;
}
.player-card img {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 10px;
}
#drawButton {
  background: gold;
  color: black;
  font-size: 18px;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  margin-top: 20px;
  cursor: pointer;
}
#drawButton:hover { background: orange; }

.match-box {
  margin-top: 10px;
  background: #111;
  border: 1px solid yellow;
  border-radius: 8px;
  padding: 5px;
  display: inline-block;
  min-width: 150px;
}
</style>
</head>
<body>

<h1>ğŸ Pasta League â€” Season 2025 âš½</h1>

<h2>ğŸ† ×˜×‘×œ×ª ×œ×™×’×”</h2>
<table id="leagueTable">
  <thead>
    <tr><th>××§×•×</th><th>×©×—×§×Ÿ</th><th>× ×¦×—×•× ×•×ª</th><th>×ª×™×§×•</th><th>×”×¤×¡×“×™×</th><th>×©×¢×¨×™ ×–×›×•×ª</th><th>×©×¢×¨×™ ×—×•×‘×”</th><th>× ×§'</th></tr>
  </thead>
  <tbody></tbody>
</table>

<h2>âš½ ××œ×š ×”×©×¢×¨×™×</h2>
<table id="scorersTable">
  <thead><tr><th>××§×•×</th><th>×©×—×§×Ÿ</th><th>×©×¢×¨×™×</th></tr></thead>
  <tbody></tbody>
</table>

<h2>ğŸ“¸ ×¨×©×™××ª ×©×—×§× ×™×</h2>
<div id="playersList"></div>

<h2>ğŸ² ×”×’×¨×œ×” ×œ××—×–×•×¨ ×”×‘×</h2>
<button id="drawButton">×‘×¦×¢ ×”×’×¨×œ×”</button>
<p id="drawInfo"></p>
<div id="matchResults"></div>

<script>
// === SETTINGS ===
const SHEET_ID = "1--or-XBf1Ys71it7cRCSnZOodHIP8wr9bW_HUoTJtCs";
const LEAGUE_SHEET = "LeagueTable";
const PLAYERS_SHEET = "Players";
const LEAGUE_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${LEAGUE_SHEET}`;
const PLAYERS_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${PLAYERS_SHEET}`;
const DRAW_KEY = "pasta_league_draw_results";
const PASSWORD = "1122";

// === FETCH LEAGUE TABLE ===
async function loadLeague() {
  const res = await fetch(LEAGUE_URL);
  const text = await res.text();
  const rows = text.split("\n").slice(1).map(r => r.split(","));
  const tbody = document.querySelector("#leagueTable tbody");
  tbody.innerHTML = "";

  rows.forEach((r, i) => {
    if (!r[0]) return;
    const tr = document.createElement("tr");
    if (i < 2) tr.classList.add("gold");
    else if (i < 6) tr.classList.add("playoff");

    tr.innerHTML = `
      <td>${i+1}</td>
      <td>${r[0]}</td>
      <td>${r[1]}</td>
      <td>${r[2]}</td>
      <td>${r[3]}</td>
      <td>${r[4]}</td>
      <td>${r[5]}</td>
      <td>${r[6]}</td>
    `;
    tbody.appendChild(tr);
  });
}

// === FETCH PLAYERS + SCORERS ===
async function loadPlayers() {
  const res = await fetch(PLAYERS_URL);
  const text = await res.text();
  const rows = text.split("\n").slice(1).map(r => r.split(","));
  const list = document.getElementById("playersList");
  const scorers = [];

  list.innerHTML = "";
  rows.forEach(r => {
    if (!r[0]) return;
    list.innerHTML += `
      <div class="player-card">
        <img src="${r[8] || ''}" alt="${r[0]}">
        <h3>${r[0]}</h3>
        <p>${r[6]}</p>
      </div>`;
    scorers.push({name: r[0], goals: parseInt(r[5]||0)});
  });

  scorers.sort((a,b)=>b.goals - a.goals);
  const tbody = document.querySelector("#scorersTable tbody");
  tbody.innerHTML = "";
  scorers.slice(0,5).forEach((s,i)=>{
    tbody.innerHTML += `<tr><td>${i+1}</td><td>${s.name} ${i===0?'âš½':''}</td><td>${s.goals}</td></tr>`;
  });
}

// === DRAW SYSTEM ===
function shuffle(arr) {
  return arr.sort(()=>Math.random()-0.5);
}

function loadDraw() {
  const saved = localStorage.getItem(DRAW_KEY);
  if (!saved) return;
  const data = JSON.parse(saved);
  document.getElementById("drawInfo").innerText = `×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”: ${data.date}`;
  const box = document.getElementById("matchResults");
  box.innerHTML = "";
  data.matches.forEach(m => {
    const div = document.createElement("div");
    div.className = "match-box";
    div.innerText = `${m[0]} âš”ï¸ ${m[1]}`;
    box.appendChild(div);
  });
}

function doDraw() {
  const pass = prompt("×”×›× ×¡ ×¡×™×¡××”:");
  if (pass !== PASSWORD) return alert("×¡×™×¡××” ×©×’×•×™×” âŒ");

  const players = Array.from(document.querySelectorAll("#leagueTable tbody tr td:nth-child(2)")).map(td => td.textContent);
  const shuffled = shuffle(players);
  const matches = [];
  for (let i=0; i<shuffled.length; i+=2) {
    if (shuffled[i+1]) matches.push([shuffled[i], shuffled[i+1]]);
  }
  const date = new Date().toLocaleString("he-IL");
  localStorage.setItem(DRAW_KEY, JSON.stringify({date, matches}));
  loadDraw();
}

// === INIT ===
loadLeague();
loadPlayers();
loadDraw();
document.getElementById("drawButton").addEventListener("click", doDraw);
</script>
</body>
</html>
