<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PASTA LEAGUE 2025</title>
  <style>
    /* === PASTA LEAGUE â€“ dark + gold === */
    :root{
      --bg:#0e0e0e; --panel:#151515; --gold:#ffd048; --muted:#b9b9b9; --line:#2a2a2a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:radial-gradient(1200px 600px at 50% -120px, #1f1f1f 0%, #0e0e0e 60%, #0b0b0b 100%);color:#fff}
    header{padding:22px 14px;border-bottom:2px solid var(--gold);text-align:center}
    header h1{margin:0 0 6px 0;letter-spacing:.06em;color:var(--gold)}
    header small{color:var(--muted)}
    main{padding:18px}
    .wrap{max-width:940px;margin:0 auto;display:grid;gap:22px}
    .card{background:linear-gradient(180deg, #141414, #101010);border:1px solid var(--line);border-radius:14px;padding:18px 16px;box-shadow:0 0 0 1px rgba(255,208,72,.12), 0 12px 28px rgba(0,0,0,.45)}
    .card h2{margin:0 0 12px 0;color:var(--gold)}
    .hint{color:var(--muted);font-size:.9rem}
    table{width:100%;border-collapse:collapse;background:#111;border:1px solid var(--line);overflow:hidden;border-radius:10px}
    th,td{padding:10px 12px;border-bottom:1px solid #222;text-align:center}
    th{color:var(--gold);font-weight:700;background:#0f0f0f}
    tr.leader td{background:rgba(255,208,72,.13);position:relative}
    tr.leader td:first-child::before{content:"ğŸ¥‡";margin-right:6px}
    .totals{display:flex;gap:10px;flex-wrap:wrap}
    .pill{background:#111;border:1px solid var(--line);padding:8px 12px;border-radius:999px;color:#eaeaea}
    footer{border-top:1px solid var(--line);text-align:center;padding:14px;color:#9a9a9a;margin-top:22px}
    .error{background:#2b1111;border:1px solid #522;border-radius:10px;padding:12px;color:#ffd6d6}
    .iframeBox{background:#0f0f0f;border:1px dashed #333;border-radius:10px;padding:8px}
  </style>
</head>
<body>
<header>
  <h1>PASTA LEAGUE â€” SEASON 2025</h1>
  <small>Total Goals: <span id="totalGoals">0</span> âš½</small>
</header>

<main>
  <div class="wrap">

    <!-- League Table (built from CSV) -->
    <section class="card">
      <h2>League Table</h2>
      <div id="csvError" class="error" style="display:none"></div>
      <div class="totals">
        <div class="pill">Matches: <span id="totalMatches">0</span></div>
        <div class="pill">Teams: <span id="totalTeams">0</span></div>
      </div>
      <div style="margin-top:12px;overflow-x:auto">
        <table id="leagueTable">
          <thead>
            <tr>
              <th>Rank</th><th>Player</th><th>W</th><th>D</th><th>L</th>
              <th>GF</th><th>GA</th><th>Pts</th>
            </tr>
          </thead>
          <tbody><tr><td colspan="8" class="hint">Loading leagueâ€¦</td></tr></tbody>
        </table>
      </div>
    </section>

    <!-- Top Scorers (auto from same CSV if columns exist) -->
    <section class="card">
      <h2>Top Scorers</h2>
      <div style="overflow-x:auto">
        <table id="scorersTable">
          <thead><tr><th>#</th><th>Player</th><th>Goals</th></tr></thead>
          <tbody><tr><td colspan="3" class="hint">Loadingâ€¦</td></tr></tbody>
        </table>
      </div>
    </section>

    <!-- Goal of the Week (paste a video link) -->
    <section class="card">
      <h2>Goal of the Week ğŸ¥</h2>
      <div class="iframeBox">
        <!-- ×©×™× ×›××Ÿ ×œ×™× ×§ ×œ×™×•×˜×™×•×‘/×“×¨×™×™×‘ ×œ×”×‘×œ×˜×” -->
        <iframe id="gotwFrame" src="" width="100%" height="320" style="border:0" allowfullscreen></iframe>
      </div>
      <p class="hint">××™×Ÿ ×¡×¨×˜×•×Ÿ? ×œ× × ×•×¨× â€” ×”×©××¨× ×• ××§×•× ××•×›×Ÿ. ××—×¨ ×›×š × ×©×™× ×œ×™× ×§.</p>
    </section>

  </div>
</main>

<footer>Created by Ben â€” Pasta League 2025 ğŸ</footer>

<script>
/* ========== SETTINGS ========== */
// ×”-ID ×©×œ ×”×’×™×œ×™×•×Ÿ ×©×œ×š:
const SHEET_ID = "1--or-XBf1Ys71it7cRCSnZOodHIP8wr9bW_HUoTJtCs";
// ××¡×¤×¨ ×”Ö¾gid ×©×œ ×”×˜××‘ (×‘×“×¨×š ×›×œ×œ 0 ×œ×˜××‘ ×”×¨××©×•×Ÿ). ×¢×“×›×Ÿ ×× ×¦×¨×™×š.
const GID = "0";
// ×›×ª×•×‘×ª CSV: ×¢×•×‘×“×ª ×¢× "Anyone with the link â€“ Viewer"
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&id=${SHEET_ID}&gid=${GID}`;

// ×©×“×•×ª ×©××•×ª ×¢××•×“×•×ª ××¤×©×¨×™×™× (×ª××™×›×” ×‘×× ×’×œ×™×ª/×¢×‘×¨×™×ª)
const COLS = {
  player: ["Player","×©×—×§×Ÿ","Name","×©×"],
  w: ["W","Wins","× ×¦×—×•× ×•×ª"],
  d: ["D","Draws","×ª×™×§×•"],
  l: ["L","Losses","×”×¤×¡×“×™×"],
  gf: ["GF","Goals+","×©×¢×¨×™×+","Goals For"],
  ga: ["GA","Goals-","×©×¢×¨×™×-","Goals Against"],
  pts: ["Pts","Points","× ×§×•×“×•×ª"],
  goals: ["Goals","GF","×©×¢×¨×™×+"] // ×œ×©×™××•×© ×‘×˜×‘×œ×ª ×”×›×•×‘×©×™×
};

function findColIndex(headers, names){
  for (const n of names){
    const idx = headers.findIndex(h => h.trim().toLowerCase() === String(n).trim().toLowerCase());
    if (idx !== -1) return idx;
  }
  return -1;
}

function parseCSV(text){
  // ×¤×™×¦×•×œ CSV ×¤×©×•×˜ (×ª×•××š ×‘××¨×›××•×ª)
  const rows = [];
  let row = [], cell = "", inQuotes = false;
  for (let i=0;i<text.length;i++){
    const c = text[i], n = text[i+1];
    if (c === '"' && n === '"'){ cell += '"'; i++; continue; }
    if (c === '"'){ inQuotes = !inQuotes; continue; }
    if (c === ',' && !inQuotes){ row.push(cell); cell=""; continue; }
    if ((c === '\n' || c === '\r') && !inQuotes){
      if (cell !== "" || row.length){ row.push(cell); rows.push(row); row=[]; cell=""; }
      continue;
    }
    cell += c;
  }
  if (cell !== "" || row.length) { row.push(cell); rows.push(row); }
  return rows.filter(r => r.length && r.some(v => v.trim() !== ""));
}

function textNum(v){ const n = parseInt(String(v).replace(/[^\d\-]/g,""),10); return isNaN(n)?0:n; }

async function loadLeague(){
  const err = document.getElementById("csvError");
  try{
    const r = await fetch(CSV_URL, {cache:"no-store"});
    if (!r.ok) throw new Error("CSV not accessible (check share and GID)");
    const txt = await r.text();
    const rows = parseCSV(txt);
    if (!rows.length) throw new Error("Empty CSV");

    const headers = rows[0].map(h=>h.trim());
    const data = rows.slice(1);

    const ci = {
      player: findColIndex(headers, COLS.player),
      w:      findColIndex(headers, COLS.w),
      d:      findColIndex(headers, COLS.d),
      l:      findColIndex(headers, COLS.l),
      gf:     findColIndex(headers, COLS.gf),
      ga:     findColIndex(headers, COLS.ga),
      pts:    findColIndex(headers, COLS.pts),
      goals:  findColIndex(headers, COLS.goals)
    };

    const records = data.map(r => ({
      player: ci.player>-1 ? r[ci.player] : "",
      w:  ci.w>-1 ? textNum(r[ci.w]) : 0,
      d:  ci.d>-1 ? textNum(r[ci.d]) : 0,
      l:  ci.l>-1 ? textNum(r[ci.l]) : 0,
      gf: ci.gf>-1 ? textNum(r[ci.gf]) : 0,
      ga: ci.ga>-1 ? textNum(r[ci.ga]) : 0,
      pts:ci.pts>-1? textNum(r[ci.pts]): 0,
      goals: ci.goals>-1 ? textNum(r[ci.goals]) : 0
    })).filter(x => x.player);

    // ××™×•×Ÿ ×œ×¤×™ × ×§×•×“×•×ª, ×•××– ×”×¤×¨×© ×©×¢×¨×™×, ×•××– GF
    records.sort((a,b)=>{
      if (b.pts !== a.pts) return b.pts - a.pts;
      const gdA = a.gf - a.ga, gdB = b.gf - b.ga;
      if (gdB !== gdA) return gdB - gdA;
      return b.gf - a.gf;
    });

    // ×‘× ×™×™×ª ×˜×‘×œ×ª ×œ×™×’×”
    const tbody = document.querySelector("#leagueTable tbody");
    tbody.innerHTML = "";
    let totalGoals = 0, totalMatches = 0;
    records.forEach((r, i)=>{
      totalGoals += r.gf;
      totalMatches += (r.w + r.d + r.l);
      const tr = document.createElement("tr");
      if (i===0) tr.className="leader";
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${r.player}</td>
        <td>${r.w}</td>
        <td>${r.d}</td>
        <td>${r.l}</td>
        <td>${r.gf}</td>
        <td>${r.ga}</td>
        <td>${r.pts}</td>`;
      tbody.appendChild(tr);
    });
    document.getElementById("totalGoals").textContent = totalGoals;
    document.getElementById("totalMatches").textContent = totalMatches;
    document.getElementById("totalTeams").textContent = records.length;

    // ×˜×‘×œ×ª ××œ×š ×”×©×¢×¨×™× (×× ×§×™×™××ª ×¢××•×“×ª Goals/GF)
    const scorers = [...records].sort((a,b)=>b.goals-a.goals).slice(0,20);
    const sbody = document.querySelector("#scorersTable tbody");
    sbody.innerHTML = "";
    if (!scorers.length){
      sbody.innerHTML = `<tr><td colspan="3" class="hint">No goals data found. Add a "Goals" or "GF" column.</td></tr>`;
    } else {
      scorers.forEach((r,i)=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${i+1}</td><td>${r.player}</td><td>${r.goals}</td>`;
        sbody.appendChild(tr);
      });
    }

  }catch(e){
    const msg = [
      "Can't load the sheet.",
      "Check that the sheet is set to â€œAnyone with the link â€“ Viewerâ€,",
      "and that the GID is correct (now using gid=" + GID + ")."
    ].join(" ");
    err.style.display="block";
    err.textContent = msg;
    console.error(e);
  }
}

loadLeague();

/* Goal of the Week â€“ ×× ×ª×¨×¦×” ×œ×”×˜××™×¢ ×¡×¨×˜×•×Ÿ, ×©×™× ×¤×” URL ×©×œ YouTube/embed ××• Google Drive preview */
const GOTW_URL = ""; // ×“×•×’××”: "https://www.youtube.com/embed/VIDEO_ID"
if (GOTW_URL) document.getElementById("gotwFrame").src = GOTW_URL;
</script>
</body>
</html>
